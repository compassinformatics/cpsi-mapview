<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-util-ZoomerMixin'>/**
</span> * A mixin to allow zooming to extents and extents
 * returned in a model
 *
 * @class CpsiMapview.util.ZoomerMixin
 */
Ext.define(&#39;CpsiMapview.util.ZoomerMixin&#39;, {
    extend: &#39;Ext.Mixin&#39;,

    requires: [
        &#39;BasiGX.util.Map&#39;
    ],

<span id='CpsiMapview-util-ZoomerMixin-property-zoomDefaults'>    zoomDefaults: {
</span>        duration: 20 // ms
    },

<span id='CpsiMapview-util-ZoomerMixin-method-zoomToFeature'>    /**
</span>     * Zoom the map to the selected feature with a buffer
     *
     * @param {ol.Feature} feature
     * @param {ol.Map} map
     * @private
     */
    zoomToFeature: function (feature, map) {

        var me = this;

        var geom = feature.getGeometry();

        // check for null features
        if (!geom) {
            return;
        }

        // TODO check for feature type when zooming
        var extent = geom.getExtent();
        var view = me.getView();
        // as this is a point then buffer it by the extentBuffer property

        var extentBuffer = view.extentBuffer ? view.extentBuffer : 100;

        extent = ol.extent.buffer(extent, extentBuffer);

        var mapView = map.getView();

        var resolution = mapView.getResolutionForExtent(extent);
        var zoom = mapView.getZoomForResolution(resolution);
        var center = ol.extent.getCenter(extent);
        var duration = 2000;

        mapView.animate({
            center: center,
            duration: duration
        });

        mapView.animate(
            {
                zoom: zoom - 1,
                duration: duration / 2
            },
            {
                zoom: zoom,
                duration: duration / 2
            }
        );
    },

<span id='CpsiMapview-util-ZoomerMixin-method-zoomMap'>    /**
</span>     * Zoom the map object to the extent of the layer
     * See https://openlayers.org/en/latest/apidoc/module-ol_View-View.html#fit
     * for options
     */
    zoomMap: function (extent, options) {

        var me = this;
        options = options || {};

        // apply zoom defaults if not supplied

        Ext.applyIf(options, me.zoomDefaults);

        var mapCompenent = BasiGX.util.Map.getMapComponent();

        if (!mapCompenent) {
            return false;
        }

        var map = mapCompenent.map;

        // only attempt a zoom if there is a map and a valid geometry or extent

        if (map &amp;&amp; (!ol.extent.isEmpty(extent))) {
            map.getView().fit(extent);
        }

    },

<span id='CpsiMapview-util-ZoomerMixin-method-zoomToRecordExtent'>    /**
</span>     * Zoom the map object to the extent of the layer
     * See https://openlayers.org/en/latest/apidoc/module-ol_View-View.html#fit
     * for options
     */
    zoomToRecordExtent: function (options) {

        var me = this;
        // mixin will be added to the controller so needs getView()
        var rec = me.getView().getViewModel().get(&#39;currentRecord&#39;);
        if (rec) {
            var extent = rec.getRecordBounds();
            if (extent) {
                me.zoomMap(extent, options);
            }
        }
    },

<span id='CpsiMapview-util-ZoomerMixin-method-zoomToExtentUsingService'>    /**
</span>    * Zoom using a bbox provided by the .NET services
    **/
    zoomToExtentUsingService: function (url, id) {

        Ext.Ajax.request({
            url: Ext.String.format(url, id),
            method: &#39;GET&#39;,
            success: function (response) {
                response = Ext.decode(response.responseText);
                // TODO - display error if not a success
                // create event and display it in the app bar
                if (response.success === true) {
                    this.zoomToBounds(response.data);
                }
            },
            scope: this
        });
    },

<span id='CpsiMapview-util-ZoomerMixin-method-zoomToBounds'>    /**
</span>     * Zoom to extent using a JSON object with bbox in epsg:3857
     **/
    zoomToBounds: function (data) {
        var bbox = [data.minX3857, data.minY3857, data.maxX3857, data.maxY3857];
        this.zoomMap(bbox);
    }
});</pre>
</body>
</html>
