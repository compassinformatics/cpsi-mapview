<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-Application'>/**
</span> * The main application class. An instance of this class is created by app.js when it
 * calls Ext.application(). This is the ideal place to handle application launch and
 * initialization details.
 */
Ext.define(&#39;CpsiMapview.Application&#39;, {
    extend: &#39;Ext.app.Application&#39;,

    requires: [
        &#39;CpsiMapview.view.main.Main&#39;
    ],

<span id='CpsiMapview-Application-property-mainViewXType'>    mainViewXType: &#39;cmv_main&#39;,
</span>
    mixins: {
        appmixin: &#39;CpsiMapview.util.ApplicationMixin&#39;
    },

<span id='CpsiMapview-Application-property-tokenName'>    /**
</span>     * Override the settings in CpsiMapview.util.ApplicationMixin
     */
    tokenName: &#39;pmstoken&#39;,
<span id='CpsiMapview-Application-property-authenticationUrl'>    authenticationUrl: &#39;/WebServices/authorization/authenticate&#39;,
</span><span id='CpsiMapview-Application-property-tokenValidationUrl'>    tokenValidationUrl: &#39;/WebServices/authorization/validateToken&#39;,
</span>
<span id='CpsiMapview-Application-property-requireLogin'>    requireLogin: false,
</span>
<span id='CpsiMapview-Application-property-name'>    name: &#39;CpsiMapview&#39;,
</span>
<span id='CpsiMapview-Application-property-quickTips'>    quickTips: false,
</span><span id='CpsiMapview-Application-property-platformConfig'>    platformConfig: {
</span>        desktop: {
            quickTips: true
        }
    },

<span id='CpsiMapview-Application-property-stores'>    stores: [
</span>        // TODO: add global / shared stores here
    ],

<span id='CpsiMapview-Application-method-launch'>    launch: function () {
</span>        // TODO - Launch the application
    },

<span id='CpsiMapview-Application-method-rewriteRemoveServiceRequests'>    rewriteRemoveServiceRequests: function (options) {
</span>
        var me = this;
        var hostname = window.location.hostname;
        var regex = /compassinformatics.github.io/g; // /localhost/g;
        var m = regex.exec(hostname);
        var serviceUrl = options.url;

        if (m) {
            var serviceUrls = [&#39;/WebServices&#39;, &#39;/pmspy&#39;];

            var urlTest = function (url) {
                var ignoreCase = true;
                return Ext.String.startsWith(serviceUrl, url, ignoreCase);
            };

            if (Ext.Array.some(serviceUrls, urlTest) === true) {
                var tokenValue = Ext.util.Cookies.get(me.tokenName);
                if (tokenValue) {
                    var token = Ext.String.format(&#39;token={0}&#39;, tokenValue);
                    serviceUrl = Ext.String.urlAppend(serviceUrl, token);
                }
                serviceUrl = &#39;https://pmstipperarydev.compass.ie&#39; + serviceUrl;
            }

            options.url = serviceUrl;
        }
    },

<span id='CpsiMapview-Application-method-onAjaxBeforeRequest'>    onAjaxBeforeRequest: function (conn, options) {
</span>        var me = this;
        if (options.url) {
            me.rewriteRemoveServiceRequests(options);
        }
    }
});
</pre>
</body>
</html>
