<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-form-ViewMixin'>/**
</span> * To be mixed into any edit form window.
 * Provides default buttons which can be hidden by assigning values to the viewModel
 * @class CpsiMapview.form.ViewMixin
 */
Ext.define(&#39;CpsiMapview.form.ViewMixin&#39;, {
    extend: &#39;Ext.Mixin&#39;,
    requires: [
        &#39;CpsiMapview.view.button.DigitizeButton&#39;,
        &#39;CpsiMapview.view.button.SplitByClickButton&#39;
    ],
<span id='CpsiMapview-form-ViewMixin-property-mixinConfig'>    mixinConfig: {
</span>        after: {
            constructor: &#39;initViewModel&#39;,
            initTools: &#39;addTools&#39; // can use any function name here
        }
    },

<span id='CpsiMapview-form-ViewMixin-method-addTools'>    /**
</span>    * **Warning** modifying the this.tools array or using .addTool at any point
    * prior to the initTools function is called causes duplicated tools
    * across all forms using this mixin!
    * This is why a separate function is required.
    * */
    addTools: function () {
        var me = this;

        // depending on the global application flag enableIsLocked
        // hide or show the padlock icon in the window header
        var app = Ext.getApplication ? Ext.getApplication() : Ext.app.Application.instance;
        var addPadlock = app.enableIsLocked;

        if (addPadlock !== false) {
            var toolConfig = {
                xtype: &#39;tool&#39;,
                callback: &#39;onPadlockClick&#39;,
                bind: {
                    hidden: &#39;{currentRecord.phantom}&#39;,
                    disabled: &#39;{!canUnlock}&#39;,
                    glyph: &#39;{padlockIcon}&#39;,
                    tooltip: &#39;{padlockToolText}&#39;
                }
            };
            me.header.insert(0, toolConfig);
        }
    },

<span id='CpsiMapview-form-ViewMixin-property-defaultEditButtons'>    defaultEditButtons: [{
</span>        xtype: &#39;button&#39;,
        itemId: &#39;deleteButton&#39;,
        text: &#39;Delete&#39;,
        handler: &#39;onDeleteClick&#39;,
        tooltip: &#39;Permanently delete the record&#39;,
        bind: {
            hidden: &#39;{hideDeleteButton}&#39;,
            disabled: &#39;{!canDelete}&#39;,
            text: &#39;{deleteButtonText}&#39; // TODO this never appears to be set. Remove?
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;rejectButton&#39;,
        text: &#39;Reject&#39;,
        handler: &#39;onRejectClick&#39;,
        bind: {
            hidden: &#39;{hideRejectButton}&#39;,
            disabled: &#39;{!canReject}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;exportButton&#39;,
        text: &#39;Export&#39;,
        handler: &#39;onExportClick&#39;,
        tooltip: &#39;Export the record to Excel (only available for existing records)&#39;,
        style: {
            pointerEvents: &#39;all&#39; // display tooltip even when the button is disabled
        },
        bind: {
            hidden: &#39;{hideExportButton}&#39;,
            disabled: &#39;{!canExport}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;zoomButton&#39;,
        text: &#39;Zoom&#39;,
        handler: &#39;onZoomClick&#39;,
        tooltip: &#39;Zoom the map to the location of the record&#39;,
        bind: {
            hidden: &#39;{hideZoomButton}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;refreshButton&#39;,
        text: &#39;Refresh&#39;,
        handler: &#39;onRefreshClick&#39;,
        tooltip: &#39;Reload the record with the latest data from the server (only available for existing records)&#39;,
        style: {
            pointerEvents: &#39;all&#39; // display tooltip even when the button is disabled
        },
        bind: {
            hidden: &#39;{hideRefreshButton}&#39;,
            disabled: &#39;{!canRefresh}&#39;
        }
    },
    {
        xtype: &#39;cmv_digitize_button&#39;,
        itemId: &#39;segmentDigitiserButton&#39;,
        type: &#39;Point&#39;,
        tooltip: &#39;Create features by clicking points on the road schedule&#39;,
        toggleGroup: &#39;map&#39;,
        useContextMenu: false,
        groups: false,
        resetOnToggle: false,
        pointExtentBuffer: 50,
        iconCls: &#39;icon-line3&#39;,
        glyph: null,  // set this or we get the default glyph and the icon
        drawLayerStyle: new ol.style.Style({
            image: new ol.style.Circle({
                radius: 5,
                fill: new ol.style.Fill({
                    color: &#39;rgba(135,206,250,1)&#39; // circle fill lightskyblue with opacity as last value
                }),
                stroke: new ol.style.Stroke({
                    color: &#39;rgba(70, 130, 180)&#39; // steelblue outline of circle
                })
            })
        }),
        listeners: {
            toggle: &#39;onDigitizingToolToggle&#39;
        },
        bind: {
            apiUrl: &#39;{networkSolverUrl}&#39;,
            disabled: &#39;{isLocked}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideDigitiseSegmentButton}&#39;
        }
    },
    {
        xtype: &#39;cmv_digitize_button&#39;,
        itemId: &#39;areaDigitiserButton&#39;,
        type: &#39;Polygon&#39;,
        tooltip: &#39;Create features by drawing polygons to select parts of the road schedule&#39;,
        toggleGroup: &#39;map&#39;,
        apiUrl: &#39;/WebServices/roadschedule/cutWithPolygon&#39;,
        resetOnToggle: false,
        iconCls: &#39;icon-polygon2&#39;,
        glyph: null,
        listeners: {
            toggle: &#39;onDigitizingToolToggle&#39;
        },
        bind: {
            drawLayer: &#39;{polygonLayer}&#39;,
            disabled: &#39;{isLocked}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideDigitiseAreaButton}&#39;
        }
    },
    {
        xtype: &#39;cmv_digitize_button&#39;,
        itemId: &#39;lineDigitiserButton&#39;,
        type: &#39;LineString&#39;,
        tooltip: &#39;Create features by drawing lines&#39;,
        toggleGroup: &#39;map&#39;,
        resetOnToggle: false,
        iconCls: &#39;icon-line3&#39;,
        glyph: null,
        bind: {
            drawLayer: &#39;{resultLayer}&#39;,
            disabled: &#39;{isLocked}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideDigitiseLineButton}&#39;
        }
    },
    {
        xtype: &#39;cmv_digitize_button&#39;,
        itemId: &#39;circleDigitiserButton&#39;,
        type: &#39;Circle&#39;,
        tooltip: &#39;Create features by drawing circles to select parts of the road schedule&#39;,
        toggleGroup: &#39;map&#39;,
        apiUrl: &#39;/WebServices/roadschedule/cutWithPolygon&#39;,
        resetOnToggle: false,
        glyph: &#39;xf1db@FontAwesome&#39;,
        listeners: {
            toggle: &#39;onDigitizingToolToggle&#39;
        },
        bind: {
            drawLayer: &#39;{polygonLayer}&#39;,
            disabled: &#39;{isLocked}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideDigitiseCircleButton}&#39;
        }
    },
    {
        xtype: &#39;cmv_digitize_button&#39;,
        itemId: &#39;pointDigitiserButton&#39;,
        type: &#39;Point&#39;,
        tooltip: &#39;Create points by clicking on the map&#39;,
        toggleGroup: &#39;map&#39;,
        resetOnToggle: false,
        glyph: &#39;xf1db@FontAwesome&#39;,
        bind: {
            drawLayer: &#39;{resultLayer}&#39;,
            disabled: &#39;{isLocked}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideDigitisePointButton}&#39;
        }
    },
    {
        xtype: &#39;cmv_split_by_click_button&#39;,
        itemId: &#39;splitByClickButton&#39;,
        apiUrl: &#39;/WebServices/roadschedule/publicprivatesplit/split&#39;,
        tooltip: &#39;Split a line by clicking on it&#39;,
        bind: {
            disabled: &#39;{isProcessed}&#39;,
            resultLayer: &#39;{resultLayer}&#39;,
            hidden: &#39;{hideSplitByClickButton}&#39;
        }
    },
    { xtype: &#39;tbfill&#39; },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;saveButton&#39;,
        text: &#39;Save&#39;,
        handler: &#39;onSaveClick&#39;,
        // Save button tooltips are updated using CpsiMapview.form.ValidationMessagesMixin
        tooltip: &#39;Save the record&#39;,
        bind: {
            disabled: &#39;{!canSave}&#39;,
            hidden: &#39;{hideSaveButton}&#39;,
            text: &#39;{saveButtonText}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;approveButton&#39;,
        text: &#39;Approve&#39;,
        handler: &#39;onApproveClick&#39;,
        bind: {
            disabled: &#39;{!canApprove}&#39;,
            hidden: &#39;{hideApproveButton}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;cancelButton&#39;,
        text: &#39;Cancel&#39;,
        handler: &#39;onCancelClick&#39;,
        tooltip: &#39;Discard any changes without saving and close the window&#39;,
        bind: {
            hidden: &#39;{hideCancelButton}&#39;
        }
    },
    {
        xtype: &#39;button&#39;,
        itemId: &#39;closeButton&#39;,
        text: &#39;Close&#39;,
        handler: &#39;onCloseClick&#39;,
        tooltip: &#39;Close the window&#39;,
        bind: {
            hidden: &#39;{hideCloseButton}&#39;
        }
    }],

<span id='CpsiMapview-form-ViewMixin-method-initViewModel'>    initViewModel: function () {
</span>
        var me = this;
        var vm = me.getViewModel();

        // apply default button visibility if not set already in the ViewModel

        Ext.applyIf(vm.getData(), {
            hideDeleteButton: false,
            hideExportButton: true,
            hideZoomButton: false,
            hideRefreshButton: true,
            hideDigitiseSegmentButton: true,
            hideDigitiseAreaButton: true,
            hideDigitiseLineButton: true,
            hideDigitiseCircleButton: true,
            hideDigitisePointButton: true,
            hideSplitByClickButton: true,
            hideSaveButton: false,
            hideCancelButton: false,
            hideCloseButton: true,
            hideConfirmButton: true,
            hideRejectButton: true,
            hideApproveButton: true,
            // the CpsiMapview.model.window.MinimizableWindow default helpUrl will be overwritten by the subclasses
            // so reset the default here if required, otherwise the help button always appears
            helpUrl: &#39;&#39;
        });

        var buttons = me.defaultEditButtons;

        // add in any custom buttons from the view
        // this should be an array of objects in the form
        // [{index: 3, button: {xtype: &#39;&#39;...}}]
        if (me.customButtons) {
            buttons = Ext.Array.clone(buttons);
            Ext.each(me.customButtons, function (cfg) {
                Ext.Array.insert(buttons, cfg.index, [cfg.button]);
            });
        }

        me.addDocked({
            xtype: &#39;toolbar&#39;,
            dock: &#39;bottom&#39;,
            itemId: &#39;buttonBar&#39;,
            items: buttons
        });
    }
});
</pre>
</body>
</html>
