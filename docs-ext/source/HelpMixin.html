<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-form-HelpMixin'>/**
</span> * A mixin that can be added to a controller
 * to handle opening system help links
 *
 * @class CpsiMapview.form.HelpMixin
 */
Ext.define(&#39;CpsiMapview.form.HelpMixin&#39;, {
    extend: &#39;Ext.Mixin&#39;,

<span id='CpsiMapview-form-HelpMixin-method-onHelp'>    /**
</span>     * Opens any associated helpUrl in a new browser tab
     * If the URL does not start with &#39;http&#39; then an application
     * rootHelpUrl is appended to the URL if present
     * @return {String} Full URL to the help page*
     */
    onHelp: function () {

        var me = this;

        // get the helpUrl from the viewmodel (if set)
        var vm = me.getViewModel();
        var helpUrl = vm ? vm.get(&#39;helpUrl&#39;) : &#39;&#39;;

        // unsure why Ext.getApplication is sometimes undefined
        var app = Ext.getApplication ? Ext.getApplication() : Ext.app.Application.instance;
        var rootUrl = app.rootHelpUrl;

        if (!helpUrl &amp;&amp; !rootUrl) {
            //&lt;debug&gt;
            Ext.log.error(&#39;No helpUrl or rootUrl link provided&#39;);
            //&lt;/debug&gt;
            return;
        }

        var fullUrl = me.buildHelpUrl(helpUrl, rootUrl);
        var win = window.open(fullUrl, &#39;mapview-help&#39;); // use &#39;_blank&#39; if we want a new window each time

        if (!win) {
            Ext.Msg.alert(&#39;Pop-up Blocked&#39;, &#39;The help page was blocked from opening. Please allow pop-ups for this site.&#39;);
        } else {
            win.focus();
        }

        return fullUrl;
    },

<span id='CpsiMapview-form-HelpMixin-method-buildHelpUrl'>    /**
</span>    * Build a URL based on root and page fragments
    *
    * @param {String} helpUrl A full URL or a relative link within the documentation
    * @param {String} rootUrl A root/base URL for the documentation
    * @return {String} Full URL to the help page
    * @private
    */
    buildHelpUrl: function (helpUrl, rootUrl) {

        var fullUrl;

        if (rootUrl &amp;&amp; (Ext.String.startsWith(helpUrl, &#39;http&#39;) === false)) {

            // trim any slashes from the URLs to avoid double slashes
            if (Ext.String.endsWith(rootUrl, &#39;/&#39;)) {
                rootUrl = rootUrl.slice(0, -1);
            }

            if (Ext.String.startsWith(helpUrl, &#39;/&#39;)) {
                helpUrl = helpUrl.slice(1);
            }

            // now format the URLs with a single slash
            fullUrl = Ext.String.format(&#39;{0}/{1}&#39;, rootUrl, helpUrl);

        } else {
            // no rootUrl is set or the link URL is a direct http link
            fullUrl = helpUrl;
        }

        return fullUrl;
    }
});</pre>
</body>
</html>
