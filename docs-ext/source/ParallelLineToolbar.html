<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-view-toolbar-ParallelLineToolbar'>/**
</span> * This class is the toolbar for creating parallel lines.
 * @class CpsiMapview.view.toolbar.ParallelLineToolbar
 */
Ext.define(&#39;CpsiMapview.view.toolbar.ParallelLineToolbar&#39;, {
    extend: &#39;Ext.toolbar.Toolbar&#39;,
    xtype: &#39;cmv_parallel_line_toolbar&#39;,

    requires: [
        &#39;Ext.form.field.Number&#39;,
        &#39;BasiGX.view.component.Map&#39;,
        &#39;CpsiMapview.util.Turf&#39;
    ],

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-property-cls'>    cls: &#39;cmv_parallel_line_toolbar&#39;,
</span>
<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-property-viewModel'>    viewModel: {
</span>        data: {
            offsetLabel: &#39;Offset&#39;,
            parallelTooltip: &#39;Create parallel line&#39;,
            offset: 0,
            feature: null,
            parallelFeature: null
        }
    },

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-property-name'>    name: null,
</span>
<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-event-parallelLineCreated'>    /**
</span>     * @event parallelLineCreated
     * Fires, when a new parallel line was created.
     * @param {ol.Feature} parallelFeature The created parallel feature.
     */

    config: {
<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-cfg-feature'>        /**
</span>         * The feature to create the parallel line for.
         */
        feature: null,
<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-cfg-offsetUnit'>        /**
</span>         * The unit to use for calculating the offset. Can be one of
         * &#39;degrees&#39;, &#39;radians&#39;, &#39;miles&#39;, &#39;kilometers&#39;, &#39;inches&#39;,
         * &#39;yards&#39;, &#39;meters&#39;.
         *
         * Defaults to &#39;meters&#39;.
         */
        offsetUnit: &#39;meters&#39;
    },

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-property-items'>    items: [{
</span>        xtype: &#39;numberfield&#39;,
        bind: {
            fieldLabel: &#39;{offsetLabel}&#39;,
            value: &#39;{offset}&#39;,
        },
        listeners: {
            change: function () {
                var toolbar = this.up(&#39;cmv_parallel_line_toolbar&#39;);

                var vm = toolbar.getViewModel();
                if (!vm) {
                    return;
                }
                var parallelFeature = vm.get(&#39;parallelFeature&#39;);
                if (!parallelFeature) {
                    return;
                }

                toolbar.createParallelFeature();
            }
        }
    }, {
        glyph: &#39;ea50@font-gis&#39;,
        bind: {
            tooltip: &#39;{parallelTooltip}&#39;,
            disabled: &#39;{!feature}&#39;
        },
        handler: function() {
            var toolbar = this.up(&#39;cmv_parallel_line_toolbar&#39;);
            toolbar.createParallelFeature();
        }
    }],

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-method-applyFeature'>    applyFeature: function (feature) {
</span>        if (!feature) {
            return;
        }
        var geometry = feature.getGeometry();
        if (!geometry) {
            Ext.log.warn(&#39;Feature has no geometry.&#39;);
            return;
        }

        var geomType = geometry.getType();
        if (geomType !== &#39;LineString&#39; &amp;&amp; geomType !== &#39;MultiLineString&#39;) {
            Ext.log.warn(&#39;Unsupported feature geometry. Geometry must be of type &quot;LineString&quot; or &quot;MultiLineString&quot;.&#39;);
            return;
        }
        return feature;
    },

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-method-updateFeature'>    updateFeature: function (newFeature) {
</span>        var vm = this.getViewModel();
        if (!vm) {
            return;
        }
        vm.set(&#39;feature&#39;, newFeature);
        vm.set(&#39;parallelFeature&#39;, null);
    },

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-method-applyOffsetUnit'>    applyOffsetUnit: function (offsetUnit) {
</span>        if (!offsetUnit) {
            Ext.log.warn(&#39;offsetUnit is empty or undefined&#39;);
            return;
        }
        var supportedUnits = [
            &#39;degrees&#39;, &#39;radians&#39;, &#39;miles&#39;, &#39;kilometers&#39;, &#39;inches&#39;,
            &#39;yards&#39;, &#39;meters&#39;
        ];
        if (supportedUnits.indexOf(offsetUnit) === -1) {
            Ext.log.warn(
                &#39;Provided offsetUnit not supported. Must be one of: &#39; + supportedUnits
            );
            return;
        }
        return offsetUnit;
    },

<span id='CpsiMapview-view-toolbar-ParallelLineToolbar-method-createParallelFeature'>    /**
</span>     * Creates a parallel line for the given feature with given offset.
     *
     * Fires the parallelLineCreated event.
     *
     * @returns {void}
     */
    createParallelFeature: function() {
        var vm = this.getViewModel();
        if (!vm) {
            return;
        }
        var feature = vm.get(&#39;feature&#39;);
        if (!feature) {
            return;
        }

        var offset = vm.get(&#39;offset&#39;);
        if (offset === null) {
            return;
        }

        var map = BasiGX.view.component.Map.guess().getMap();
        if (!map) {
            return;
        }

        var offsetUnit = this.getOffsetUnit();
        var turfUtil = CpsiMapview.util.Turf;
        var parallelFeature = turfUtil.createParallelFeature(map, feature, offset, offsetUnit);
        vm.set(&#39;parallelFeature&#39;, parallelFeature);
        this.fireEvent(&#39;parallelLineCreated&#39;, parallelFeature);
    }
});
</pre>
</body>
</html>
