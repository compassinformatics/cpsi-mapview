<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='CpsiMapview-controller-form-LayerTreeFilter'>/**
</span> * This is the controller for the {@link CpsiMapview.view.form.LayerTreeFilter} component
 *
 * @class CpsiMapview.controller.form.LayerTreeFilter
 */
Ext.define(&#39;CpsiMapview.controller.form.LayerTreeFilter&#39;, {
    extend: &#39;Ext.app.ViewController&#39;,

    alias: &#39;controller.cmv_layertreefilter&#39;,

    requires: [
        &#39;CpsiMapview.util.LayerTreeFilter&#39;
    ],

<span id='CpsiMapview-controller-form-LayerTreeFilter-method-clearText'>    /**
</span>     * Clears the textfield for filtering the layer tree.
     *
     * @param {Ext.form.field.Text } textField
     */
    clearText: function (textField) {
        var me = this;
        var view = me.getView();

        textField.setValue(&#39;&#39;);

        var tree = Ext.ComponentQuery.query(&#39;cmv_layertree&#39;)[0];
        if (!tree) {
            return;
        }
        var store = tree.getStore();
        if (!store) {
            return;
        }

        // remove previous filter if exists
        store.removeFilter(view.TEXT_FILTER_ID);
    },

<span id='CpsiMapview-controller-form-LayerTreeFilter-method-updateFilter'>    /**
</span>     * Updates the filter with the latest input values.
     *
     * @return {void}
     */
    updateFilter: function() {
        var me = this;
        var view = me.getView();
        var vm = view.getViewModel();
        var LayerTreeFilterUtil = CpsiMapview.util.LayerTreeFilter;

        var tree = Ext.ComponentQuery.query(&#39;cmv_layertree&#39;)[0];
        if (!tree) {
            return;
        }
        var store = tree.getStore();
        if (!store) {
            return;
        }

        store.removeFilter(view.FILTER_ID);
        var filter = LayerTreeFilterUtil.createLayerTreeFilter(
            view.FILTER_ID,
            vm.get(&#39;hideInvisibleLayers&#39;),
            vm.get(&#39;searchText&#39;),
            view.getDoFilterBaseLayers()
        );
        store.addFilter(filter);
    },

<span id='CpsiMapview-controller-form-LayerTreeFilter-method-onSearchTextChange'>    /**
</span>     * Handler for the input field change event.
     *
     * @param {Ext.form.field.Text} textfield The textfield.
     * @param {string} searchText The search text.
     * @return  {void}
     */
    onSearchTextChange: function(textfield, searchText) {
        var treeFilter = textfield.up(&#39;cmv_layertreefilter&#39;);
        var vm = treeFilter.getViewModel();
        var ctrl = treeFilter.getController();
        if (!vm || !ctrl) {
            return;
        }
        vm.set(&#39;searchText&#39;, searchText);
        ctrl.updateFilter();
    },

<span id='CpsiMapview-controller-form-LayerTreeFilter-method-onCheckboxChange'>    /**
</span>     * Handler for the checkbox change event.
     *
     * @param {Ext.form.field.Checkbox} cb The checkbox.
     * @param {boolean} checked True, if checked. False otherwise.
     * @return {void}
     */
    onCheckboxChange: function(cb, checked) {
        var treeFilter = cb.up(&#39;cmv_layertreefilter&#39;);
        var vm = treeFilter.getViewModel();
        var ctrl = treeFilter.getController();
        if (!vm || !ctrl) {
            return;
        }
        vm.set(&#39;hideInvisibleLayers&#39;, checked);
        ctrl.updateFilter();
    }
});
</pre>
</body>
</html>
