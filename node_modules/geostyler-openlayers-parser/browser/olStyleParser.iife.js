var GeoStylerOpenlayersParser=function(B){"use strict";function be(n){return!/^(-?\d|--)/.test(n)}function Oe(n){const e=[];let t="",i="",r=7;for(let s,o=0;s=n.charAt(o);o++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(s)&&r===7)t+=s;else if(s==="\\"&&r===7)r=6;else if(s===" "&&r===7){if(t!==""){if(!be(t))return null;e.push(t),t=""}}else if(r===6)/[0-9a-f]/i.test(s)?(i+=s,r=8):(t+=s,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(s)&&i.length<6?i+=s:(t+=String.fromCodePoint(parseInt(i,16)),t+=s,i="",r=7)}if(t!==""){if(!be(t))return null;e.push(t)}return e.join(" ")}function yt(n,e){let t=e,i="";const r={"font-family":[]};for(let s,o=0;s=n.charAt(o);o+=1)if(t!==4||s!=='"'&&s!=="'")if(t===3&&s===",")t=4,i="";else if(t===4&&s===","){const a=Oe(i);a&&r["font-family"].push(a),i=""}else if(t===5&&s===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(i)?(r["font-style"]+=" "+i,i=""):o-=1,t=1;else if(t!==1||s!==" "&&s!=="/")t===2&&s===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(i)&&(r["line-height"]=i),t=4,i=""):i+=s;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(i)||/^(?:larg|small)er$/.test(i)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(i))t=s==="/"?2:4,r["font-size"]=i;else if(/^italic$/.test(i))r["font-style"]=i;else if(/^oblique$/.test(i))r["font-style"]=i,t=5;else if(/^small-caps$/.test(i))r["font-variant"]=i;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(i))r["font-weight"]=i;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(i)){const a=parseFloat(i);a>=1&&a<=1e3&&(r["font-weight"]=i)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(i)&&(r["font-stretch"]=i);i=""}else{let a=o+1;do if(a=n.indexOf(s,a)+1,!a)return null;while(n.charAt(a-2)==="\\");r["font-family"].push(n.slice(o+1,a-1).replace(/\\('|")/g,"$1")),o=a-1,t=3,i=""}if(t===3&&!/^\s*$/.test(i))return null;if(t===4){const s=Oe(i);s&&r["font-family"].push(s)}return r}function St(n){const e=yt(n,1);return e!==null&&e["font-size"]&&e["font-family"].length?e:null}var k=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},y={},Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});var xe={};Object.defineProperty(xe,"__esModule",{value:!0});var ke={},pt=typeof k=="object"&&k&&k.Object===Object&&k,vt=pt,Ct=vt,wt=typeof self=="object"&&self&&self.Object===Object&&self,bt=Ct||wt||Function("return this")(),Ot=bt,Ft=Ot,xt=Ft.Symbol,Te=xt,Ie=Te,Ee=Object.prototype,kt=Ee.hasOwnProperty,Tt=Ee.toString,D=Ie?Ie.toStringTag:void 0;function It(n){var e=kt.call(n,D),t=n[D];try{n[D]=void 0;var i=!0}catch{}var r=Tt.call(n);return i&&(e?n[D]=t:delete n[D]),r}var Et=It,Rt=Object.prototype,At=Rt.toString;function Pt(n){return At.call(n)}var Lt=Pt,Re=Te,Mt=Et,Dt=Lt,Gt="[object Null]",zt="[object Undefined]",Ae=Re?Re.toStringTag:void 0;function Wt(n){return n==null?n===void 0?zt:Gt:Ae&&Ae in Object(n)?Mt(n):Dt(n)}var ee=Wt,Nt=Array.isArray,jt=Nt;function $t(n){return n!=null&&typeof n=="object"}var te=$t,Bt=ee,Xt=jt,Yt=te,qt="[object String]";function Ut(n){return typeof n=="string"||!Xt(n)&&Yt(n)&&Bt(n)==qt}var Vt=Ut,Ht=ee,Jt=te,Kt="[object Number]";function Zt(n){return typeof n=="number"||Jt(n)&&Ht(n)==Kt}var Qt=Zt,ei=ee,ti=te,ii="[object Boolean]";function ni(n){return n===!0||n===!1||ti(n)&&ei(n)==ii}var ri=ni;(function(n){var e=k&&k.__importDefault||function(l){return l&&l.__esModule?l:{default:l}};Object.defineProperty(n,"__esModule",{value:!0}),n.isGeoStylerFunction=n.isGeoStylerUnknownFunction=n.isGeoStylerBooleanFunction=n.isGeoStylerStringFunction=n.isGeoStylerNumberFunction=n.isGrayChannel=n.isRgbChannel=n.isRule=n.isRasterSymbolizer=n.isFillSymbolizer=n.isLineSymbolizer=n.isMarkSymbolizer=n.isTextSymbolizer=n.isIconSymbolizer=n.isPointSymbolizer=n.isSymbolizer=n.isNegationFilter=n.isCombinationFilter=n.isComparisonFilter=n.isFilter=n.isNegationOperator=n.isCombinationOperator=n.isComparisonOperator=n.isOperator=n.isScaleDenominator=n.isPropertyType=n.isFunctionCall=n.isExpression=void 0;var t=e(Vt),i=e(Qt),r=e(ri),s=function(l){return(0,n.isGeoStylerFunction)(l)||(0,n.isPropertyType)(l)};n.isExpression=s;var o=function(l){return l.type==="functioncall"&&l.hasOwnProperty("name")&&(0,t.default)(l.name)&&l.hasOwnProperty("args")&&Array.isArray(l.args)&&l.args.every(function(w){return(0,n.isExpression)(w)})};n.isFunctionCall=o;var a=function(l){return(0,t.default)(l)||(0,i.default)(l)||(0,r.default)(l)||l===null};n.isPropertyType=a;var c=function(l){return!!((l!=null&&l.min||l!=null&&l.max)&&(!l.min||(0,n.isGeoStylerNumberFunction)(l.min)||(0,i.default)(l.min))&&(!l.max||(0,n.isGeoStylerNumberFunction)(l.max)||(0,i.default)(l.min)))};n.isScaleDenominator=c;var h=function(l){return(0,n.isComparisonOperator)(l)||(0,n.isCombinationOperator)(l)||(0,n.isNegationOperator)(l)};n.isOperator=h;var u=function(l){return["==","*=","!=","<","<=",">",">=","<=x<="].includes(l)};n.isComparisonOperator=u;var f=function(l){return["&&","||"].includes(l)};n.isCombinationOperator=f;var g=function(l){return l==="!"};n.isNegationOperator=g;var _=function(l){return(0,n.isComparisonFilter)(l)||(0,n.isCombinationFilter)(l)||(0,n.isGeoStylerBooleanFunction)(l)||(0,n.isNegationFilter)(l)||(0,n.isGeoStylerBooleanFunction)(l)||(0,r.default)(l)};n.isFilter=_;var d=function(l){var w=l&&l[0]==="<=x<="?4:3;return Array.isArray(l)&&l.length===w&&(0,n.isComparisonOperator)(l[0])&&(0,n.isExpression)(l[1])&&(0,n.isExpression)(l[2])&&(l[0]!=="<=x<="||(0,i.default)(l[3]))};n.isComparisonFilter=d;var S=function(l){return Array.isArray(l)&&l.length>=3&&(0,n.isCombinationOperator)(l[0])&&l.every(function(w,we){return we===0||(0,n.isFilter)(w)})};n.isCombinationFilter=S;var p=function(l){return Array.isArray(l)&&l.length===2&&(0,n.isNegationOperator)(l[0])&&(0,n.isFilter)(l[1])};n.isNegationFilter=p;var C=function(l){return(0,n.isPointSymbolizer)(l)||(0,n.isLineSymbolizer)(l)||(0,n.isFillSymbolizer)(l)||(0,n.isRasterSymbolizer)(l)};n.isSymbolizer=C;var b=function(l){return(0,n.isIconSymbolizer)(l)||(0,n.isMarkSymbolizer)(l)||(0,n.isTextSymbolizer)(l)};n.isPointSymbolizer=b;var O=function(l){return(l==null?void 0:l.kind)==="Icon"};n.isIconSymbolizer=O;var x=function(l){return(l==null?void 0:l.kind)==="Text"};n.isTextSymbolizer=x;var E=function(l){return(l==null?void 0:l.kind)==="Mark"&&(0,t.default)(l==null?void 0:l.wellKnownName)};n.isMarkSymbolizer=E;var $=function(l){return(l==null?void 0:l.kind)==="Line"};n.isLineSymbolizer=$;var An=function(l){return(l==null?void 0:l.kind)==="Fill"};n.isFillSymbolizer=An;var Pn=function(l){return(l==null?void 0:l.kind)==="Raster"};n.isRasterSymbolizer=Pn;var Ln=function(l){var w;return!!((0,t.default)(l==null?void 0:l.name)&&(!(l!=null&&l.filter)||(0,n.isFilter)(l.filter))&&(!(l!=null&&l.scaleDenominator)||(0,n.isScaleDenominator)(l.scaleDenominator))&&(!((w=l==null?void 0:l.symbolizers)===null||w===void 0)&&w.every(function(we){return(0,n.isSymbolizer)(we)})))};n.isRule=Ln;var Mn=function(l){return(l==null?void 0:l.redChannel)!==void 0||(l==null?void 0:l.greenChannel)!==void 0||(l==null?void 0:l.blueChannel)!==void 0};n.isRgbChannel=Mn;var Dn=function(l){return(l==null?void 0:l.grayChannel)!==void 0};n.isGrayChannel=Dn;var Gn=function(l){var w=["abs","acos","add","asin","atan","atan2","ceil","cos","div","exp","floor","log","max","min","modulo","mul","pi","pow","random","rint","round","sin","sqrt","strIndexOf","strLastIndexOf","strLength","sub","tan","toDegrees","toRadians"];return w.includes(l==null?void 0:l.name)};n.isGeoStylerNumberFunction=Gn;var zn=function(l){var w=["numberFormat","strAbbreviate","strCapitalize","strConcat","strDefaultIfBlank","strReplace","strStripAccents","strSubstring","strSubstringStart","strToLowerCase","strToUpperCase","strTrim"];return w.includes(l==null?void 0:l.name)};n.isGeoStylerStringFunction=zn;var Wn=function(l){var w=["all","any","between","double2bool","equalTo","greaterThan","greaterThanOrEqualTo","in","lessThan","lessThanOrEqualTo","not","notEqualTo","parseBoolean","strEndsWith","strEqualsIgnoreCase","strMatches","strStartsWith"];return w.includes(l==null?void 0:l.name)};n.isGeoStylerBooleanFunction=Wn;var Nn=function(l){var w=["case","property"];return w.includes(l==null?void 0:l.name)};n.isGeoStylerUnknownFunction=Nn;var jn=function(l){return(0,n.isGeoStylerBooleanFunction)(l)||(0,n.isGeoStylerNumberFunction)(l)||(0,n.isGeoStylerStringFunction)(l)||(0,n.isGeoStylerUnknownFunction)(l)};n.isGeoStylerFunction=jn})(ke),function(n){var e=k&&k.__createBinding||(Object.create?function(i,r,s,o){o===void 0&&(o=s);var a=Object.getOwnPropertyDescriptor(r,s);(!a||("get"in a?!r.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return r[s]}}),Object.defineProperty(i,o,a)}:function(i,r,s,o){o===void 0&&(o=s),i[o]=r[s]}),t=k&&k.__exportStar||function(i,r){for(var s in i)s!=="default"&&!Object.prototype.hasOwnProperty.call(r,s)&&e(r,i,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(Fe,n),t(xe,n),t(ke,n)}(y);var F={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class si{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}var Pe=si,oi={PROPERTYCHANGE:"propertychange"};class ai{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}var li=ai;function Le(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function Me(){}function ci(n){let e=!1,t,i,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!Le(s,i))&&(e=!0,r=this,i=s,t=n.apply(this,arguments)),t}}function De(n){for(const e in n)delete n[e]}function hi(n){let e;for(e in n)return!1;return!e}class ui extends li{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=t?new Pe(e):e;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let c;for(let h=0,u=r.length;h<u;++h)if("handleEvent"in r[h]?c=r[h].handleEvent(s):c=r[h].call(this,s),c===!1||s.propagationStopped){c=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Me);delete o[i]}return c}disposeInternal(){this.listeners_&&De(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){const i=this.listeners_&&this.listeners_[e];if(i){const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=Me,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}}var Ge=ui,R={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ie(n,e,t,i,r){if(i&&i!==n&&(t=t.bind(i)),r){const o=t;t=function(){n.removeEventListener(e,t),o.apply(this,arguments)}}const s={target:n,type:e,listener:t};return n.addEventListener(e,t),s}function X(n,e,t,i){return ie(n,e,t,i,!0)}function ne(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),De(n))}class Y extends Ge{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(R.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=ie(this,e[s],t);return r}return ie(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=X(this,e[s],t)}else i=X(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)fi(i);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}Y.prototype.on,Y.prototype.once,Y.prototype.un;function fi(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)ne(n[e]);else ne(n)}var di=Y;function v(){throw new Error("Unimplemented abstract method.")}let gi=0;function ze(n){return n.ol_uid||(n.ol_uid=String(++gi))}class We extends Pe{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class mi extends di{constructor(e){super(),this.on,this.once,this.un,ze(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new We(i,e,t)),i=oi.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new We(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],hi(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}var Ne=mi;const T=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"";T.includes("firefox"),T.includes("safari")&&!T.includes("chrom")&&(T.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(T)),T.includes("webkit")&&T.includes("edge"),T.includes("macintosh");const _i=typeof devicePixelRatio<"u"?devicePixelRatio:1,yi=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Si=typeof Image<"u"&&Image.prototype.decode;(function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n})();const pi={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection",69:"`width` or `height` cannot be provided together with `scale`"};class vi extends Error{constructor(e){const t=pi[e];super(t),this.code=e,this.name="AssertionError",this.message=t}}var Ci=vi;function G(n,e){if(!n)throw new Ci(e)}const wi=new Array(6);function re(){return[1,0,0,1,0,0]}function bi(n,e){const t=n[0],i=n[1],r=n[2],s=n[3],o=n[4],a=n[5],c=e[0],h=e[1],u=e[2],f=e[3],g=e[4],_=e[5];return n[0]=t*c+r*h,n[1]=i*c+s*h,n[2]=t*u+r*f,n[3]=i*u+s*f,n[4]=t*g+r*_+o,n[5]=i*g+s*_+a,n}function Oi(n,e,t,i,r,s,o){return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n[4]=s,n[5]=o,n}function Fi(n,e,t){return bi(n,Oi(wi,e,0,0,t,0,0))}function je(n,e,t,i,r,s,o,a){const c=Math.sin(s),h=Math.cos(s);return n[0]=i*h,n[1]=r*c,n[2]=-i*c,n[3]=r*h,n[4]=o*i*h-a*i*c+e,n[5]=o*r*c+a*r*h+t,n}function xi(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function ki(){return[1/0,1/0,-1/0,-1/0]}function $e(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function Be(n){return $e(1/0,1/0,-1/0,-1/0,n)}function Ti(n,e){const t=n[0],i=n[1];return $e(t,i,t,i,e)}function Ii(n,e,t,i,r){const s=Be(r);return Ei(s,n,e,t,i)}function Ei(n,e,t,i,r){for(;t<i;t+=r)Ri(n,e[t],e[t+1]);return n}function Ri(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function Ai(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function Xe(n){return n[3]-n[1]}function z(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function Pi(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}const Ye={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Li{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Ye[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}var qe=Li;const W=6378137,A=Math.PI*W,Mi=[-A,-A,A,A],Di=[-180,-85,180,85],q=W*Math.log(Math.tan(Math.PI/2));class P extends qe{constructor(e){super({code:e,units:"m",extent:Mi,global:!0,worldExtent:Di,getPointResolution:function(t,i){return t/Math.cosh(i[1]/W)}})}}const Ue=[new P("EPSG:3857"),new P("EPSG:102100"),new P("EPSG:102113"),new P("EPSG:900913"),new P("http://www.opengis.net/def/crs/EPSG/0/3857"),new P("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Gi(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t){e[r]=A*n[r]/180;let s=W*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));s>q?s=q:s<-q&&(s=-q),e[r+1]=s}return e}function zi(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t)e[r]=180*n[r]/A,e[r+1]=360*Math.atan(Math.exp(n[r+1]/W))/Math.PI-90;return e}const Wi=6378137,Ve=[-180,-90,180,90],Ni=Math.PI*Wi/180;class I extends qe{constructor(e,t){super({code:e,units:"degrees",extent:Ve,axisOrientation:t,global:!0,metersPerUnit:Ni,worldExtent:Ve})}}const He=[new I("CRS:84"),new I("EPSG:4326","neu"),new I("urn:ogc:def:crs:OGC:1.3:CRS84"),new I("urn:ogc:def:crs:OGC:2:84"),new I("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new I("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new I("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let se={};function ji(n){return se[n]||se[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function $i(n,e){se[n]=e}let L={};function U(n,e,t){const i=n.getCode(),r=e.getCode();i in L||(L[i]={}),L[i][r]=t}function Bi(n,e){let t;return n in L&&e in L[n]&&(t=L[n][e]),t}function V(n,e,t){return Math.min(Math.max(n,e),t)}function Xi(n,e,t,i){const r=t-n,s=i-e;return r*r+s*s}function Yi(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Je(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function qi(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function Ui(n){$i(n.getCode(),n),U(n,n,Je)}function Vi(n){n.forEach(Ui)}function oe(n){return typeof n=="string"?ji(n):n||null}function Ke(n){Vi(n),n.forEach(function(e){n.forEach(function(t){e!==t&&U(e,t,Je)})})}function Hi(n,e,t,i){n.forEach(function(r){e.forEach(function(s){U(r,s,t),U(s,r,i)})})}function Ji(n,e){const t=n.getCode(),i=e.getCode();let r=Bi(t,i);return r||(r=qi),r}function Ze(n,e){const t=oe(n),i=oe(e);return Ji(t,i)}function Ki(){Ke(Ue),Ke(He),Hi(He,Ue,Gi,zi)}Ki();function N(n,e,t,i,r,s){s=s||[];let o=0;for(let a=e;a<t;a+=i){const c=n[a],h=n[a+1];s[o++]=r[0]*c+r[2]*h+r[4],s[o++]=r[1]*c+r[3]*h+r[5]}return s&&s.length!=o&&(s.length=o),s}function Zi(n,e,t,i,r,s,o){o=o||[];const a=Math.cos(r),c=Math.sin(r),h=s[0],u=s[1];let f=0;for(let g=e;g<t;g+=i){const _=n[g]-h,d=n[g+1]-u;o[f++]=h+_*a-d*c,o[f++]=u+_*c+d*a;for(let S=g+2;S<g+i;++S)o[f++]=n[S]}return o&&o.length!=f&&(o.length=f),o}function Qi(n,e,t,i,r,s,o,a){a=a||[];const c=o[0],h=o[1];let u=0;for(let f=e;f<t;f+=i){const g=n[f]-c,_=n[f+1]-h;a[u++]=c+r*g,a[u++]=h+s*_;for(let d=f+2;d<f+i;++d)a[u++]=n[d]}return a&&a.length!=u&&(a.length=u),a}function en(n,e,t,i,r,s,o){o=o||[];let a=0;for(let c=e;c<t;c+=i){o[a++]=n[c]+r,o[a++]=n[c+1]+s;for(let h=c+2;h<c+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const Qe=re();class tn extends Ne{constructor(){super(),this.extent_=ki(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ci(function(e,t,i){if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return v()}closestPointXY(e,t,i,r){return v()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return v()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&Be(t),this.extentRevision_=this.getRevision()}return Pi(this.extent_,e)}rotate(e,t){v()}scale(e,t,i){v()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return v()}getType(){return v()}applyTransform(e){v()}intersectsExtent(e){return v()}translate(e,t){v()}transform(e,t){const i=oe(e),r=i.getUnits()=="tile-pixels"?function(s,o,a){const c=i.getExtent(),h=i.getWorldExtent(),u=Xe(h)/Xe(c);return je(Qe,h[0],h[3],u,-u,0,0,0),N(s,0,s.length,a,Qe,o),Ze(i,t)(s,o,a)}:Ze(i,t);return this.applyTransform(r),this}}var nn=tn;class rn extends nn{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(e){return Ii(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return v()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=et(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){v()}setLayout(e,t,i){let r;if(e)r=et(e);else{for(let s=0;s<i;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=sn(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();Zi(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=Ai(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();Qi(r,0,r.length,s,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();en(i,0,i.length,r,e,t,i),this.changed()}}}function sn(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function et(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function on(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return N(i,0,i.length,r,e,t)}var an=rn;function ln(n,e,t,i){for(let r=0,s=t.length;r<s;++r)n[e++]=t[r];return e}class ae extends an{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new ae(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,o=Xi(e,t,s[0],s[1]);if(o<r){const a=this.stride;for(let c=0;c<a;++c)i[c]=s[c];return i.length=a,o}return r}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(e){return Ti(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return xi(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ln(this.flatCoordinates,0,e,this.stride),this.changed()}}var cn=ae;function H(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class le{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=H(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new le({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return v()}getImage(e){return v()}getHitDetectionImage(){return v()}getPixelRatio(e){return 1}getImageState(){return v()}getImageSize(){return v()}getOrigin(){return v()}getSize(){return v()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=H(e)}listenImageChange(e){v()}load(){v()}unlistenImageChange(e){v()}}var ce=le;const hn=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,un=/^([a-z]*)$|^hsla?\(.*\)$/i;function tt(n){return typeof n=="string"?n:rt(n)}function fn(n){const e=document.createElement("div");if(e.style.color=n,e.style.color!==""){document.body.appendChild(e);const t=getComputedStyle(e).color;return document.body.removeChild(e),t}return""}const dn=function(){const e={};let t=0;return function(i){let r;if(e.hasOwnProperty(i))r=e[i];else{if(t>=1024){let s=0;for(const o in e)s++&3||(delete e[o],--t)}r=gn(i),e[i]=r,++t}return r}}();function it(n){return Array.isArray(n)?n:dn(n)}function gn(n){let e,t,i,r,s;if(un.exec(n)&&(n=fn(n)),hn.exec(n)){const o=n.length-1;let a;o<=4?a=1:a=2;const c=o===4||o===8;e=parseInt(n.substr(1+0*a,a),16),t=parseInt(n.substr(1+1*a,a),16),i=parseInt(n.substr(1+2*a,a),16),c?r=parseInt(n.substr(1+3*a,a),16):r=255,a==1&&(e=(e<<4)+e,t=(t<<4)+t,i=(i<<4)+i,c&&(r=(r<<4)+r)),s=[e,t,i,r/255]}else n.startsWith("rgba(")?(s=n.slice(5,-1).split(",").map(Number),nt(s)):n.startsWith("rgb(")?(s=n.slice(4,-1).split(",").map(Number),s.push(1),nt(s)):G(!1,14);return s}function nt(n){return n[0]=V(n[0]+.5|0,0,255),n[1]=V(n[1]+.5|0,0,255),n[2]=V(n[2]+.5|0,0,255),n[3]=V(n[3],0,1),n}function rt(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*100)/100;return"rgba("+e+","+t+","+i+","+r+")"}function M(n){return Array.isArray(n)?rt(n):n}function J(n,e,t,i){let r;return t&&t.length?r=t.shift():yi?r=new OffscreenCanvas(n||300,e||300):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}const mn="10px sans-serif",K="#000",st="round",ot=[],at=0,Z="round",he=10,ue="#000",lt="center",_n="middle",fe=1;new Ne;class de extends ce{constructor(e){const t=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:1,rotateWithView:t,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius!==void 0?e.radius:e.radius1,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const e=this.getScale(),t=new de({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_;if(!e)return null;const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(e){let t=this.canvas_[e];if(!t){const i=this.renderOptions_,r=J(i.size*e,i.size*e);this.draw_(i,r,e),t=r.canvas,this.canvas_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return F.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const $=r;r=s,s=$}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,c=s*Math.sin(a),h=Math.sqrt(s*s-c*c),u=r-h,f=Math.sqrt(c*c+u*u),g=f/c;if(e==="miter"&&g<=i)return g*t;const _=t/2/g,d=t/2*(u/f),p=Math.sqrt((r+_)*(r+_)+d*d)-r;if(this.radius2_===void 0||e==="bevel")return p*2;const C=r*Math.sin(a),b=Math.sqrt(r*r-C*C),O=s-b,E=Math.sqrt(C*C+O*O)/C;if(E<=i){const $=E*t/2-s-r;return 2*Math.max(p,$)}return p*2}createRenderOptions(){let e=Z,t=0,i=null,r=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=ue),s=M(s),o=this.stroke_.getWidth(),o===void 0&&(o=fe),i=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset(),e=this.stroke_.getLineJoin(),e===void 0&&(e=Z),t=this.stroke_.getMiterLimit(),t===void 0&&(t=he));const a=this.calculateLineJoinSize_(e,o,t),c=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*c+a);return{strokeStyle:s,strokeWidth:o,size:h,lineDash:i,lineDashOffset:r,lineJoin:e,miterLimit:t}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvas_={},this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=K),t.fillStyle=M(r),t.fill()}this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){if(this.fill_){let t=this.fill_.getColor(),i=0;if(typeof t=="string"&&(t=it(t)),t===null?i=1:Array.isArray(t)&&(i=t.length===4?t[3]:1),i===0){const r=J(e.size,e.size);this.hitDetectionCanvas_=r.canvas,this.drawHitDetectionCanvas_(e,r)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const c=s+a*o,h=a%2===0?i:r;e.lineTo(h*Math.cos(c),h*Math.sin(c))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=K,t.fill(),this.stroke_&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}}var ct=de;class ge extends ct{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new ge({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}var yn=ge;class me{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null}clone(){const e=this.getColor();return new me({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){this.color_=e}}var ht=me;class _e{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new _e({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}var Sn=_e;class ye{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=ut,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new ye({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=ut,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function ut(n){return n.getGeometry()}var pn=ye;const vn="#333";class Se{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=H(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new ht({color:vn}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding}clone(){const e=this.getScale();return new Se({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=H(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}var Cn=Se;class wn{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}}get(e,t,i){const r=ft(e,t,i);return r in this.cache_?this.cache_[r]:null}set(e,t,i,r){const s=ft(e,t,i);this.cache_[s]=r,++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function ft(n,e,t){const i=t?tt(t):"null";return e+":"+n+":"+i}const dt=new wn;function bn(n,e,t){const i=n;let r=!0,s=!1,o=!1;const a=[X(i,R.LOAD,function(){o=!0,s||e()})];return i.src&&Si?(s=!0,i.decode().then(function(){r&&e()}).catch(function(c){r&&(o?e():t())})):a.push(X(i,R.ERROR,t)),function(){r=!1,a.forEach(ne)}}let j=null;class On extends Ge{constructor(e,t,i,r,s,o){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=r,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=t,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===F.LOADED){j||(j=J(1,1,void 0,{willReadFrequently:!0})),j.drawImage(this.image_,0,0);try{j.getImageData(0,0,1,1),this.tainted_=!1}catch{j=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(R.CHANGE)}handleImageError_(){this.imageState_=F.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=F.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=J(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===F.IDLE){this.image_||this.initializeImage_(),this.imageState_=F.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=bn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==F.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const r=i.getContext("2d");r.scale(e,e),r.drawImage(t,0,0),r.globalCompositeOperation="multiply",r.fillStyle=tt(this.color_),r.fillRect(0,0,i.width/e,i.height/e),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),this.canvas_[e]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Fn(n,e,t,i,r,s){let o=dt.get(e,i,s);return o||(o=new On(n,e,t,i,r,s),dt.set(e,i,s,o)),o}function gt(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class pe extends ce{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const o=e.img!==void 0?e.img:null;this.imgSize_=e.imgSize;let a=e.src;G(!(a!==void 0&&o),4),G(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||ze(o)),G(a!==void 0&&a.length>0,6),G(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),69);const c=e.src!==void 0?F.IDLE:F.LOADED;if(this.color_=e.color!==void 0?it(e.color):null,this.iconImage_=Fn(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,c,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let h,u;if(e.size)[h,u]=e.size;else{const f=this.getImage(1);if(f instanceof HTMLCanvasElement||f.src&&f.complete)h=f.width,u=f.height;else{this.initialOptions_=e;const g=()=>{if(this.unlistenImageChange(g),!this.initialOptions_)return;const _=this.iconImage_.getSize();this.setScale(gt(_[0],_[1],e.width,e.height))};this.listenImageChange(g);return}}h!==void 0&&this.setScale(gt(h,u,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new pe({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==F.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==F.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(R.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(R.CHANGE,e)}}var xn=pe;const mt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ve=/^ttf:\/\/(.+)#(.+)$/,_t="geostyler-mark-symbolizer";class m{static getRgbaColor(e,t){if(y.isGeoStylerStringFunction(e)&&(e=m.evaluateStringFunction(e)),typeof e!="string")return;if(e.startsWith("rgba("))return e;if(!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e))return;const r=parseInt(e.slice(1,3),16),s=parseInt(e.slice(3,5),16),o=parseInt(e.slice(5,7),16);return y.isGeoStylerNumberFunction(t)&&(t=m.evaluateNumberFunction(t)),t<0&&(t=1),"rgba("+r+", "+s+", "+o+", "+t+")"}static splitRgbaColor(e){const t=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/),i=parseInt(t[0],10),r=parseInt(t[1],10),s=parseInt(t[2],10),o=parseFloat(t[3]);return[i,r,s,o]}static getHexColor(e){if(e.startsWith("#"))return e;if(e.startsWith("rgb")){const t=m.splitRgbaColor(e);return m.getHexCodeFromRgbArray(t)}else if(mt[e.toLocaleLowerCase()]!==void 0){const t=mt[e.toLocaleLowerCase()];return m.getHexCodeFromRgbArray(t)}else return}static getHexCodeFromRgbArray(e){return"#"+e.map((t,i)=>{const r=t.toString(16);return i<3?r.length===1?"0"+r:r:""}).join("")}static getOpacity(e){if(!e.startsWith("rgba("))return;const t=m.splitRgbaColor(e);if(t.length===4)return t[3]}static getTextFont(e){const t=e.fontWeight??"normal",i=e.fontStyle??"normal",r=e.size,s=e.font;return t+" "+i+" "+r+"px "+(s==null?void 0:s.join(", "))}static getIsFontGlyphBased(e){return ve.test(e.wellKnownName)}static getIsMarkSymbolizerFont(e){const t=_t;return e.substring(e.length-t.length,e.length)===t}static getTextFontForMarkSymbolizer(e){const t=e.wellKnownName.match(ve);if(!t)throw new Error(`Could not parse font-based well known name: ${e.wellKnownName}`);const i=t[1];return`Normal ${e.radius||5}px '${i}', ${_t}`}static getCharacterForMarkSymbolizer(e){const t=e.wellKnownName.match(ve);if(!t)throw new Error(`Could not parse font-based well known name: ${e.wellKnownName}`);return String.fromCharCode(parseInt(t[2],16))}static getFontNameFromOlFont(e){const t=e.match(/(?:\d+\S+) '?"?([^,'"]+)/);if(!t)throw new Error(`Could not find font family name in the following string: ${e}`);return t[1]}static getSizeFromOlFont(e){const t=e.match(/(?:(\d+)px)/);return t?parseInt(t[1],10):0}static resolveAttributeTemplate(e,t,i="n.v.",r=(s,o)=>o){let s="\\{\\{",o="\\}\\}",a=new RegExp(s+"(.*?)"+o,"g"),c=t.match(a);return c&&c.forEach(h=>{let u=0;for(let[f,g]of Object.entries(e.getProperties()))if(h.slice(2,h.length-2).toLowerCase()===f.toLowerCase()){t=t.replace(h,r(f,g));break}else u++;u===Object.keys(e.getProperties()).length&&(t=t.replace(h,i))}),t}static evaluateFunction(e,t){if(e.name==="property"){if(!t)throw new Error(`Could not evalute 'property' function. Feature ${t} is not defined.`);return y.isGeoStylerStringFunction(e.args[0])?t==null?void 0:t.get(m.evaluateStringFunction(e.args[0],t)):t==null?void 0:t.get(e.args[0])}if(y.isGeoStylerUnknownFunction(e))return m.evaluateUnknownFunction(e,t);if(y.isGeoStylerStringFunction(e))return m.evaluateStringFunction(e,t);if(y.isGeoStylerNumberFunction(e))return m.evaluateNumberFunction(e,t);if(y.isGeoStylerBooleanFunction(e))return m.evaluateBooleanFunction(e,t)}static evaluateBooleanFunction(e,t){const i=e.args.map(r=>y.isGeoStylerFunction(r)?m.evaluateFunction(r,t):r);switch(e.name){case"all":return i.map(o=>this.evaluateBooleanFunction(o,t)).every(o=>o===!0);case"any":return i.map(o=>this.evaluateBooleanFunction(o,t)).some(o=>o===!0);case"between":return i[0]>=i[1]&&i[0]<=i[2];case"double2bool":return!1;case"equalTo":return i[0]===i[1];case"greaterThan":return i[0]>i[1];case"greaterThanOrEqualTo":return i[0]>=i[1];case"in":return i.slice(1).includes(i[0]);case"lessThan":return i[0]<i[1];case"lessThanOrEqualTo":return i[0]<=i[1];case"not":return!i[0];case"notEqualTo":return i[0]!==i[1];case"parseBoolean":return!!i[0];case"strEndsWith":return i[0].endsWith(i[1]);case"strEqualsIgnoreCase":return i[0].toLowerCase()===i[1].toLowerCase();case"strMatches":const s=i[1].match(/\/(.*?)\/([gimy]{0,4})$/);return s&&s.length===3?new RegExp(s[1],s[2]).test(i[0]):!1;case"strStartsWith":return i[0].startsWith(i[1]);default:return!1}}static evaluateNumberFunction(e,t){if(e.name==="pi")return Math.PI;if(e.name==="random")return Math.random();const i=e.args.map(r=>y.isGeoStylerFunction(r)?m.evaluateFunction(r,t):r);switch(e.name){case"abs":return Math.abs(i[0]);case"acos":return Math.acos(i[0]);case"add":return i[0]+i[1];case"asin":return Math.asin(i[0]);case"atan":return Math.atan(i[0]);case"atan2":return i[0];case"ceil":return Math.ceil(i[0]);case"cos":return Math.cos(i[0]);case"div":return i[0]/i[1];case"exp":return Math.exp(i[0]);case"floor":return Math.floor(i[0]);case"log":return Math.log(i[0]);case"max":return Math.max(...i);case"min":return Math.min(...i);case"modulo":return i[0]%i[1];case"mul":return i[0]*i[1];case"pow":return Math.pow(i[0],i[1]);case"rint":return i[0];case"round":return Math.round(i[0]);case"sin":return Math.sin(i[0]);case"sqrt":return Math.sqrt(i[0]);case"strIndexOf":return i[0].indexOf(i[1]);case"strLastIndexOf":return i[0].lastIndexOf(i[1]);case"strLength":return i[0].length;case"sub":return i[0]-i[1];case"tan":return Math.tan(i[0]);case"toDegrees":return i[0]*(180/Math.PI);case"toRadians":return i[0]*(Math.PI/180);default:return i[0]}}static evaluateUnknownFunction(e,t){const i=e.args.map(r=>y.isGeoStylerFunction(r)?m.evaluateFunction(r,t):r);switch(e.name){case"property":return t==null?void 0:t.get(i[0]);case"case":const r=i;let s;for(let o=0;o<r.length;o++){const a=r[o];if(o===r.length-1){s=a;break}else if(a.case===!0){s=a.value;break}else if(m.evaluateBooleanFunction(a.case,t)){s=a.value;break}}return s;default:return i[0]}}static evaluateStringFunction(e,t){var s;const i=e.args.map(o=>y.isGeoStylerFunction(o)?m.evaluateFunction(o,t):o);switch(e.name){case"numberFormat":return i[0];case"strAbbreviate":return i[0];case"strCapitalize":var r=i[0].toLowerCase().split(" ");for(let o of r)o=o.charAt(0).toUpperCase()+o.substring(1);return r.join(" ");case"strConcat":return i.join();case"strDefaultIfBlank":return((s=i[0])==null?void 0:s.length)<1?i[1]:i[0];case"strReplace":return i[3]===!0?i[0].replaceAll(i[1],i[2]):i[0].replace(i[1],i[2]);case"strStripAccents":return i[0].normalize("NFKD").replace(/[\u0300-\u036f]/g,"");case"strSubstring":return i[0].substring(i[1],i[2]);case"strSubstringStart":return i[0].substring(i[1]);case"strToLowerCase":return i[0].toLowerCase();case"strToUpperCase":return i[0].toUpperCase();case"strTrim":return i[0].trim();default:return i[0]}}static containsGeoStylerFunctions(e){return e.rules.some(t=>{var o,a,c,h;const i=Array.isArray(t.filter)&&((o=t.filter)==null?void 0:o.some(y.isGeoStylerFunction)),r=(a=t.symbolizers)==null?void 0:a.some(u=>Object.values(u).some(y.isGeoStylerFunction)),s=y.isGeoStylerFunction((c=t==null?void 0:t.scaleDenominator)==null?void 0:c.max)||y.isGeoStylerFunction((h=t==null?void 0:t.scaleDenominator)==null?void 0:h.min);return i||r||s})}}class kn{drawCustom(e,t,i,r){}drawGeometry(e){}setStyle(e){}drawCircle(e,t){}drawFeature(e,t){}drawGeometryCollection(e,t){}drawLineString(e,t){}drawMultiLineString(e,t){}drawMultiPoint(e,t){}drawMultiPolygon(e,t){}drawPoint(e,t){}drawPolygon(e,t){}drawText(e,t){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}var Tn=kn;class In extends Tn{constructor(e,t,i,r,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?Yi(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=re()}drawImages_(e,t,i,r){if(!this.image_)return;const s=N(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,c=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=c*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,f=s.length;u<f;u+=2){const g=s[u]-this.imageAnchorX_,_=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const d=g+this.imageAnchorX_,S=_+this.imageAnchorY_;je(a,d,S,1,1,h,-d,-S),o.setTransform.apply(o,a),o.translate(d,S),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,g,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=c)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=N(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=r){const c=s[t]+this.textOffsetX_,h=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(c-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,c,h),this.textFillState_&&o.fillText(this.text_,c,h))}}moveToLineTo_(e,t,i,r,s){const o=this.context_,a=N(e,t,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let c=a.length;s&&(c-=2);for(let h=2;h<c;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),i}drawRings_(e,t,i,r){for(let s=0,o=i.length;s<o;++s)t=this.moveToLineTo_(e,t,i[s],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!z(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=on(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],s=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!z(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(z(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let c=0,h=o.length;c<h;++c)s=this.moveToLineTo_(r,s,o[c],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!z(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!z(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,c=s.length;a<c;++a){const h=s[a];r=this.drawRings_(i,r,h,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Le(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:lt;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:M(i||K)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),c=t.getWidth(),h=t.getMiterLimit(),u=s||ot;this.strokeState_={lineCap:r!==void 0?r:st,lineDash:this.pixelRatio_===1?u:u.map(f=>f*this.pixelRatio_),lineDashOffset:(o||at)*this.pixelRatio_,lineJoin:a!==void 0?a:Z,lineWidth:(c!==void 0?c:fe)*this.pixelRatio_,miterLimit:h!==void 0?h:he,strokeStyle:M(i||ue)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const _=t.getColor();this.textFillState_={fillStyle:M(_||K)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const _=i.getColor(),d=i.getLineCap(),S=i.getLineDash(),p=i.getLineDashOffset(),C=i.getLineJoin(),b=i.getWidth(),O=i.getMiterLimit();this.textStrokeState_={lineCap:d!==void 0?d:st,lineDash:S||ot,lineDashOffset:p||at,lineJoin:C!==void 0?C:Z,lineWidth:b!==void 0?b:fe,miterLimit:O!==void 0?O:he,strokeStyle:M(_||ue)}}const r=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),c=e.getRotation(),h=e.getScaleArray(),u=e.getText(),f=e.getTextAlign(),g=e.getTextBaseline();this.textState_={font:r!==void 0?r:mn,textAlign:f!==void 0?f:lt,textBaseline:g!==void 0?g:_n},this.text_=u!==void 0?Array.isArray(u)?u.reduce((_,d,S)=>_+=S%2?" ":d,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=c!==void 0?c:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}var En=In;function Rn(n,e){const t=n.canvas;e=e||{};const i=e.pixelRatio||_i,r=e.size;r&&(t.width=r[0]*i,t.height=r[1]*i,t.style.width=r[0]+"px",t.style.height=r[1]+"px");const s=[0,0,t.width,t.height],o=Fi(re(),i,i);return new En(n,i,s,o,0)}const Ce=class Ce{constructor(e){this.unsupportedProperties={Symbolizer:{MarkSymbolizer:{avoidEdges:"none",blur:"none",offsetAnchor:"none",pitchAlignment:"none",pitchScale:"none"},FillSymbolizer:{antialias:"none",opacity:{support:"none",info:"Use fillOpacity instead."}},IconSymbolizer:{allowOverlap:"none",anchor:"none",avoidEdges:"none",color:"none",haloBlur:"none",haloColor:"none",haloWidth:"none",keepUpright:"none",offsetAnchor:"none",size:{support:"partial",info:"Will set/get the width of the ol Icon."},optional:"none",padding:"none",pitchAlignment:"none",rotationAlignment:"none",textFit:"none",textFitPadding:"none"},LineSymbolizer:{blur:"none",gapWidth:"none",gradient:"none",miterLimit:"none",roundLimit:"none",spacing:"none",graphicFill:"none",graphicStroke:"none",perpendicularOffset:"none"},RasterSymbolizer:"none"},Function:{double2bool:{support:"none",info:"Always returns false"},atan2:{support:"none",info:"Currently returns the first argument"},rint:{support:"none",info:"Currently returns the first argument"},numberFormat:{support:"none",info:"Currently returns the first argument"},strAbbreviate:{support:"none",info:"Currently returns the first argument"}}},this.title="OpenLayers Style Parser",this.olIconStyleCache={},this.OlStyleConstructor=pn,this.OlStyleImageConstructor=ce,this.OlStyleFillConstructor=ht,this.OlStyleStrokeConstructor=Sn,this.OlStyleTextConstructor=Cn,this.OlStyleCircleConstructor=yn,this.OlStyleIconConstructor=xn,this.OlStyleRegularshapeConstructor=ct,this.isOlParserStyleFct=t=>typeof t=="function",e&&(this.OlStyleConstructor=e.style.Style,this.OlStyleImageConstructor=e.style.Image,this.OlStyleFillConstructor=e.style.Fill,this.OlStyleStrokeConstructor=e.style.Stroke,this.OlStyleTextConstructor=e.style.Text,this.OlStyleCircleConstructor=e.style.Circle,this.OlStyleIconConstructor=e.style.Icon,this.OlStyleRegularshapeConstructor=e.style.RegularShape)}getPointSymbolizerFromOlStyle(e){let t;if(e.getImage()instanceof this.OlStyleCircleConstructor){const i=e.getImage(),r=i.getFill(),s=i.getStroke(),o=i.getDisplacement();t={kind:"Mark",wellKnownName:"circle",color:r?m.getHexColor(r.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:r?m.getOpacity(r.getColor()):void 0,radius:i.getRadius()!==0?i.getRadius():5,strokeColor:s?s.getColor():void 0,strokeOpacity:s?m.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,offset:o[0]||o[1]?o:void 0}}else if(e.getImage()instanceof this.OlStyleRegularshapeConstructor){const i=e.getImage(),r=i.getFill(),s=i.getStroke(),o=i.getRadius(),a=i.getRadius2(),c=i.getPoints(),h=i.getAngle(),u=i.getDisplacement(),f={kind:"Mark",color:r?m.getHexColor(r.getColor()):void 0,opacity:i.getOpacity()!==1?i.getOpacity():void 0,fillOpacity:r?m.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?m.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:o!==0?o:5,rotate:i.getRotation()/Math.PI*180,offset:u[0]||u[1]?u:void 0};switch(c){case 2:switch(h){case 0:f.wellKnownName="shape://vertline";break;case Math.PI/2:f.wellKnownName="shape://horline";break;case Math.PI/4:f.wellKnownName="shape://slash";break;case 2*Math.PI-Math.PI/4:f.wellKnownName="shape://backslash";break}break;case 3:switch(h){case 0:f.wellKnownName="triangle";break;case Math.PI/2:f.wellKnownName="shape://carrow";break}break;case 4:Number.isFinite(a)?i.getAngle()===0?f.wellKnownName="cross":f.wellKnownName="x":f.wellKnownName="square";break;case 5:f.wellKnownName="star";break;default:throw new Error("Could not parse OlStyle. Only 2, 3, 4 or 5 point regular shapes are allowed")}t=f}else if(e.getText()instanceof this.OlStyleTextConstructor){const i=e.getText(),r=i.getFill(),s=i.getStroke(),o=i.getRotation();let a=i.getText()||"a";const c=i.getFont()||"10px sans-serif",h=m.getFontNameFromOlFont(c),u=m.getSizeFromOlFont(c),f=[i.getOffsetX(),i.getOffsetY()];Array.isArray(a)&&(a=a[0]),t={kind:"Mark",wellKnownName:`ttf://${h}#0x${a.charCodeAt(0).toString(16)}`,color:r?m.getHexColor(r.getColor()):void 0,opacity:r?m.getOpacity(r.getColor()):void 0,strokeColor:s?s.getColor():void 0,strokeOpacity:s?m.getOpacity(s.getColor()):void 0,strokeWidth:s?s.getWidth():void 0,radius:u!==0?u:5,rotate:o?o/Math.PI*180:0,offset:f[0]||f[1]?f:void 0}}else{const i=e.getImage(),r=i.getDisplacement(),s=i.getWidth()??i.initialOptions_.width;t={kind:"Icon",image:i.getSrc()?i.getSrc():void 0,opacity:i.getOpacity(),size:s,rotate:i.getRotation()/Math.PI*180,offset:r[0]||r[1]?r:void 0}}return t}getLineSymbolizerFromOlStyle(e){const t=e.getStroke(),i=t?t.getLineDash():void 0;return{kind:"Line",color:t?m.getHexColor(t.getColor()):void 0,opacity:t?m.getOpacity(t.getColor()):void 0,width:t?t.getWidth():void 0,cap:t?t.getLineCap():"butt",join:t?t.getLineJoin():"miter",dasharray:i||void 0,dashOffset:t?t.getLineDashOffset():void 0}}getFillSymbolizerFromOlStyle(e){const t=e.getFill(),i=e.getStroke(),r=i?i.getLineDash():void 0,s={kind:"Fill"};return t&&(s.color=m.getHexColor(t.getColor())),t&&(s.fillOpacity=m.getOpacity(t.getColor())),i&&(s.outlineColor=m.getHexColor(i.getColor())),r&&(s.outlineDasharray=r),i&&(s.outlineOpacity=m.getOpacity(i.getColor())),i&&i.getWidth()&&(s.outlineWidth=i.getWidth()),s}getTextSymbolizerFromOlStyle(e){const t=e.getText(),i=t.getFill(),r=t.getStroke(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getFont(),c=t.getRotation(),h=t.getOverflow()?t.getOverflow():void 0,u=t.getText(),f=Array.isArray(u)?u[0]:u;let g=1/0,_,d,S;if(a){const p=St(a);if(p["font-weight"]&&(d=p["font-weight"]),p["font-size"]&&(g=parseInt(p["font-size"],10)),p["font-family"]){const C=p["font-family"];_=C==null?void 0:C.map(b=>b.includes(" ")?'"'+b+'"':b)}p["font-style"]&&(S=p["font-style"])}return{kind:"Text",label:f,allowOverlap:h,color:i?m.getHexColor(i.getColor()):void 0,size:isFinite(g)?g:void 0,font:_,fontWeight:d||void 0,fontStyle:S||void 0,offset:s!==void 0&&o!==void 0?[s,o]:[0,0],haloColor:r&&r.getColor()?m.getHexColor(r.getColor()):void 0,haloWidth:r?r.getWidth():void 0,rotate:c!==void 0?c/Math.PI*180:void 0}}getSymbolizersFromOlStyle(e){const t=[];return e.forEach(i=>{let r;switch(this.getStyleTypeFromOlStyle(i)){case"Point":i.getText()&&!m.getIsMarkSymbolizerFont(i.getText().getFont())?r=this.getTextSymbolizerFromOlStyle(i):r=this.getPointSymbolizerFromOlStyle(i);break;case"Line":r=this.getLineSymbolizerFromOlStyle(i);break;case"Fill":r=this.getFillSymbolizerFromOlStyle(i);break;default:throw new Error("Failed to parse SymbolizerKind from OpenLayers Style")}t.push(r)}),t}getRuleFromOlStyle(e){let t;const i="OL Style Rule 0";return Array.isArray(e)?t=this.getSymbolizersFromOlStyle(e):t=this.getSymbolizersFromOlStyle([e]),{name:i,symbolizers:t}}getStyleTypeFromOlStyle(e){let t;if(e.getImage()instanceof this.OlStyleImageConstructor)t="Point";else if(e.getText()instanceof this.OlStyleTextConstructor)t="Point";else if(e.getFill()instanceof this.OlStyleFillConstructor)t="Fill";else if(e.getStroke()&&!e.getFill())t="Line";else throw new Error("StyleType could not be detected");return t}olStyleToGeoStylerStyle(e){const t="OL Style",i=this.getRuleFromOlStyle(e);return{name:t,rules:[i]}}readStyle(e){return new Promise(t=>{try{if(this.isOlParserStyleFct(e))t({output:e.__geoStylerStyle});else{e=e;const i=this.olStyleToGeoStylerStyle(e),r=this.checkForUnsupportedProperties(i);t({output:i,unsupportedProperties:r})}}catch(i){t({errors:[i]})}})}writeStyle(e){return new Promise(t=>{const i=structuredClone(e),r=this.checkForUnsupportedProperties(i);try{const s=this.getOlStyleTypeFromGeoStylerStyle(i);t({output:s,unsupportedProperties:r,warnings:r&&["Your style contains unsupportedProperties!"]})}catch(s){t({errors:[s]})}})}checkForUnsupportedProperties(e){const t=r=>r[0].toUpperCase()+r.slice(1),i={};if(e.rules.forEach(r=>{r.symbolizers.forEach(s=>{var c,h;const o=t(`${s.kind}Symbolizer`),a=(h=(c=this.unsupportedProperties)==null?void 0:c.Symbolizer)==null?void 0:h[o];a&&(typeof a=="string"?(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[o]=a):Object.keys(s).forEach(u=>{a[u]&&(i.Symbolizer||(i.Symbolizer={}),i.Symbolizer[o]||(i.Symbolizer[o]={}),i.Symbolizer[o][u]=a[u])}))})}),Object.keys(i).length>0)return i}getOlStyleTypeFromGeoStylerStyle(e){var r,s,o,a,c,h,u,f;const t=e.rules;if(t.length===1){const g=((s=(r=e==null?void 0:e.rules)==null?void 0:r[0])==null?void 0:s.filter)!==void 0,_=((c=(a=(o=e==null?void 0:e.rules)==null?void 0:o[0])==null?void 0:a.scaleDenominator)==null?void 0:c.min)!==void 0,d=((f=(u=(h=e==null?void 0:e.rules)==null?void 0:h[0])==null?void 0:u.scaleDenominator)==null?void 0:f.max)!==void 0,S=!!(_||d),p=m.containsGeoStylerFunctions(e),C=e.rules[0].symbolizers.length,b=t[0].symbolizers.some(x=>x.kind==="Text"),O=t[0].symbolizers.some(x=>x.kind==="Icon"&&typeof x.image=="string"&&x.image.includes("{{"));return!g&&!S&&!b&&!O&&!p?C===1?this.geoStylerStyleToOlStyle(e):this.geoStylerStyleToOlStyleArray(e):this.geoStylerStyleToOlParserStyleFct(e)}else return this.geoStylerStyleToOlParserStyleFct(e)}geoStylerStyleToOlStyle(e){const i=e.rules[0].symbolizers[0];return this.getOlSymbolizerFromSymbolizer(i)}geoStylerStyleToOlStyleArray(e){const t=e.rules[0],i=[];return t.symbolizers.forEach(r=>{const s=this.getOlSymbolizerFromSymbolizer(r);i.push(s)}),i}geoStylerStyleToOlParserStyleFct(e){const t=structuredClone(e.rules),r=(s,o)=>{const a=[],c=90.7142857142857,h=Ye.m,u=39.37,f=o*h*u*c;return t.forEach(g=>{var C,b;let _=(C=g==null?void 0:g.scaleDenominator)==null?void 0:C.min,d=(b=g==null?void 0:g.scaleDenominator)==null?void 0:b.max,S=!0;(_||d)&&(_=y.isGeoStylerFunction(_)?m.evaluateNumberFunction(_):_,d=y.isGeoStylerFunction(d)?m.evaluateNumberFunction(d):d,_&&f<_&&(S=!1),d&&f>=d&&(S=!1));let p=!1;if(!g.filter)p=!0;else try{p=this.geoStylerFilterToOlParserFilter(s,g.filter)}catch{p=!1}S&&p&&g.symbolizers.forEach(O=>{O.visibility===!1&&a.push(null),y.isGeoStylerBooleanFunction(O.visibility)&&(m.evaluateBooleanFunction(O.visibility)||a.push(null));const x=this.getOlSymbolizerFromSymbolizer(O,s);if(typeof x!="function")a.push(x);else{const E=x(s,o);a.push(E)}})}),a};return r.__geoStylerStyle=e,r}geoStylerFilterToOlParserFilter(e,t){const i={"&&":!0,"||":!0,"!":!0};let r=!0;if(y.isGeoStylerBooleanFunction(t))return m.evaluateBooleanFunction(t,e);if(t===!0||t===!1)return t;const s=t[0];let o=!1;i[s]&&(o=!0);try{if(o)switch(t[0]){case"&&":let a=!0;t.slice(1).forEach(h=>{this.geoStylerFilterToOlParserFilter(e,h)||(a=!1)}),r=a;break;case"||":a=!1,c=t.slice(1),c.forEach(h=>{this.geoStylerFilterToOlParserFilter(e,h)&&(a=!0)}),r=a;break;case"!":r=!this.geoStylerFilterToOlParserFilter(e,t[1]);break;default:throw new Error("Cannot parse Filter. Unknown combination or negation operator.")}else{let a;y.isGeoStylerFunction(t[1])?a=m.evaluateFunction(t[1],e):a=e.get(t[1]);let c;switch(y.isGeoStylerFunction(t[2])?c=e.get(m.evaluateFunction(t[2],e)):c=t[2],t[0]){case"==":r=""+a==""+c;break;case"*=":typeof c=="string"&&typeof a=="string"&&(c.length>a.length?r=!1:r=a.indexOf(c)!==-1);break;case"!=":r=""+a!=""+c;break;case"<":r=Number(a)<Number(c);break;case"<=":r=Number(a)<=Number(c);break;case">":r=Number(a)>Number(c);break;case">=":r=Number(a)>=Number(c);break;default:throw new Error("Cannot parse Filter. Unknown comparison operator.")}}}catch{throw new Error("Cannot parse Filter. Invalid structure.")}return r}getOlSymbolizerFromSymbolizer(e,t){let i;switch(e=structuredClone(e),e.kind){case"Mark":i=this.getOlPointSymbolizerFromMarkSymbolizer(e,t);break;case"Icon":i=this.getOlIconSymbolizerFromIconSymbolizer(e,t);break;case"Text":i=this.getOlTextSymbolizerFromTextSymbolizer(e,t);break;case"Line":i=this.getOlLineSymbolizerFromLineSymbolizer(e,t);break;case"Fill":i=this.getOlPolygonSymbolizerFromFillSymbolizer(e,t);break;default:const r=new this.OlStyleFillConstructor({color:"rgba(255,255,255,0.4)"}),s=new this.OlStyleStrokeConstructor({color:"#3399CC",width:1.25});i=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor({fill:r,stroke:s,radius:5}),fill:r,stroke:s});break}return i}getOlPointSymbolizerFromMarkSymbolizer(e,t){let i;for(const S of Object.keys(e))y.isGeoStylerFunction(e[S])&&(e[S]=m.evaluateFunction(e[S],t));const r=e.strokeColor,s=e.strokeOpacity,o=r&&s!==void 0?m.getRgbaColor(r,s):e.strokeColor;(e.strokeColor||e.strokeWidth!==void 0)&&(i=new this.OlStyleStrokeConstructor({color:o,width:e.strokeWidth}));const a=e.color,c=e.opacity,h=e.radius,u=e.fillOpacity,f=a&&u!==void 0?m.getRgbaColor(a,u??1):a,g=new this.OlStyleFillConstructor({color:f});let _;const d={fill:g,radius:h??5,rotation:typeof e.rotate=="number"?e.rotate*Math.PI/180:void 0,stroke:i,displacement:typeof e.offset=="number"?e.offset:void 0};switch(e.wellKnownName){case"shape://dot":case"circle":_=new this.OlStyleConstructor({image:new this.OlStyleCircleConstructor(d)});break;case"square":_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:4,angle:45*Math.PI/180})});break;case"triangle":_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:3,angle:0})});break;case"star":_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:5,radius2:d.radius/2.5,angle:0})});break;case"shape://plus":case"cross":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:4,radius2:0,angle:0})});break;case"shape://times":case"x":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:4,radius2:0,angle:45*Math.PI/180})});break;case"shape://backslash":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:2,angle:2*Math.PI-Math.PI/4})});break;case"shape://horline":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:2,angle:Math.PI/2})});break;case"shape://oarrow":case"shape://carrow":_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:3,angle:Math.PI/2})});break;case"shape://slash":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:2,angle:Math.PI/4})});break;case"shape://vertline":d.stroke===void 0&&(d.stroke=new this.OlStyleStrokeConstructor({color:"#000"})),_=new this.OlStyleConstructor({image:new this.OlStyleRegularshapeConstructor({...d,points:2,angle:0})});break;default:if(m.getIsFontGlyphBased(e)){_=new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:m.getCharacterForMarkSymbolizer(e),font:m.getTextFontForMarkSymbolizer(e),fill:d.fill,stroke:d.stroke,rotation:d.rotation})});break}throw new Error("MarkSymbolizer cannot be parsed. Unsupported WellKnownName.")}return Number.isFinite(c)&&_.getImage()&&_.getImage().setOpacity(c),_}getOlIconSymbolizerFromIconSymbolizer(e,t){for(const c of Object.keys(e))y.isGeoStylerFunction(e[c])&&(e[c]=m.evaluateFunction(e[c],t));const i={src:e.image,crossOrigin:"anonymous",opacity:e.opacity,width:e.size,rotation:typeof e.rotate=="number"?e.rotate*Math.PI/180:void 0,displacement:e.offset},r="\\{\\{",s="\\}\\}",o=new RegExp(r+".*?"+s,"g");return(typeof e.image=="string"?e.image.match(o):null)?h=>{let u=m.resolveAttributeTemplate(h,e.image,"");u||(u=e.image+"");let f;return this.olIconStyleCache[u]?(f=this.olIconStyleCache[u],i.rotation!==void 0&&f.setRotation(i.rotation),i.opacity!==void 0&&f.setOpacity(i.opacity)):(f=new this.OlStyleIconConstructor({...i,src:u}),this.olIconStyleCache[u]=f),new this.OlStyleConstructor({image:f})}:new this.OlStyleConstructor({image:new this.OlStyleIconConstructor({...i})})}getOlLineSymbolizerFromLineSymbolizer(e,t){for(const o of Object.keys(e))y.isGeoStylerFunction(e[o])&&(e[o]=m.evaluateFunction(e[o],t));const i=e.color,r=e.opacity,s=i&&r!==null&&r!==void 0?m.getRgbaColor(i,r):i;return new this.OlStyleConstructor({stroke:new this.OlStyleStrokeConstructor({color:s,width:e.width,lineCap:e.cap,lineJoin:e.join,lineDash:e.dasharray,lineDashOffset:e.dashOffset})})}getOlPolygonSymbolizerFromFillSymbolizer(e,t){for(const g of Object.keys(e))y.isGeoStylerFunction(e[g])&&(e[g]=m.evaluateFunction(e[g],t));const i=e.color,r=e.fillOpacity,s=i&&Number.isFinite(r)?m.getRgbaColor(i,r):i;let o=i?new this.OlStyleFillConstructor({color:s}):void 0;const a=e.outlineColor,c=e.outlineOpacity,h=a&&Number.isFinite(c)?m.getRgbaColor(a,c):a,u=a||e.outlineWidth?new this.OlStyleStrokeConstructor({color:h,width:e.outlineWidth,lineDash:e.outlineDasharray}):void 0,f=new this.OlStyleConstructor({fill:o,stroke:u});if(e.graphicFill){const g=this.getOlPatternFromGraphicFill(e.graphicFill);o||(o=new this.OlStyleFillConstructor({})),g&&o.setColor(g),f.setFill(o)}return f}getOlPatternFromGraphicFill(e){let t;if(y.isIconSymbolizer(e)){t=this.getOlIconSymbolizerFromIconSymbolizer(e);const g=t==null?void 0:t.getImage();if(g==null||g.load(),(g==null?void 0:g.getImageState())!==F.LOADED)return null}else if(y.isMarkSymbolizer(e))t=this.getOlPointSymbolizerFromMarkSymbolizer(e);else return null;const i=t.clone(),r=i.getImage(),s=document.createElement("canvas"),o=s.getContext("2d"),c=r.getScale()||1;r.setScale(1);const h=r.getSize(),u=Rn(o,{pixelRatio:c,size:h});u.setStyle(i);const f=h.map(g=>g/2);return u.drawGeometry(new cn(f)),o.createPattern(s,"repeat")}getOlTextSymbolizerFromTextSymbolizer(e,t){for(const d of Object.keys(e))y.isGeoStylerFunction(e[d])&&(e[d]=m.evaluateFunction(e[d],t));const i=e.color,r=e.opacity,s=i&&Number.isFinite(r)?m.getRgbaColor(i,r):i,o=e.haloColor,a=e.haloWidth,c=o&&Number.isFinite(r)?m.getRgbaColor(o,r):o,h={font:m.getTextFont(e),fill:new this.OlStyleFillConstructor({color:s}),stroke:new this.OlStyleStrokeConstructor({color:c,width:a||0}),overflow:e.allowOverlap,offsetX:e.offset?e.offset[0]:0,offsetY:e.offset?e.offset[1]:0,rotation:typeof e.rotate=="number"?e.rotate*Math.PI/180:void 0},u="\\{\\{",f="\\}\\}",g=new RegExp(u+".*?"+f,"g");let _;return y.isGeoStylerStringFunction(e.label)||(_=e.label?e.label.match(g):null),_?S=>{const p=new this.OlStyleTextConstructor({text:m.resolveAttributeTemplate(S,e.label,""),...h});return new this.OlStyleConstructor({text:p})}:new this.OlStyleConstructor({text:new this.OlStyleTextConstructor({text:e.label,...h})})}};Ce.title="OpenLayers Style Parser";let Q=Ce;return B.OlStyleParser=Q,B.default=Q,Object.defineProperty(B,"__esModule",{value:!0}),B}({});
//# sourceMappingURL=olStyleParser.iife.js.map
